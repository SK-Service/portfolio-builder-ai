<!-- portfolio-builder-ai/frontend/src/app/components/portfolio-results/portfolio-results.component.html -->

<div class="portfolio-results-container max-width-800">
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Generating your portfolio recommendations...</p>
  </div>

  <div *ngIf="!isLoading && portfolioRecommendation && riskAssessment">
    <!-- Header Summary -->
    <mat-card class="summary-card mb-3">
      <mat-card-header>
        <mat-card-title>Your Personalized Portfolio</mat-card-title>
        <mat-card-subtitle>Based on {{ riskAssessment.riskTolerance }} risk tolerance</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="summary-stats">
          <div class="stat">
            <span class="stat-label">Investment Amount</span>
            <span class="stat-value">{{ formatCurrency(riskAssessment.investmentAmount) }}</span>
          </div>
          <div class="stat">
            <span class="stat-label">Time Horizon</span>
            <span class="stat-value">{{ riskAssessment.investmentHorizonYears }} years</span>
          </div>
          <div class="stat">
            <span class="stat-label">Expected Annual Return</span>
            <span class="stat-value">{{ portfolioRecommendation.totalExpectedReturn.toFixed(1) }}%</span>
          </div>
          <div class="stat">
            <span class="stat-label">Risk Level</span>
            <span class="stat-value">{{ riskAssessment.riskTolerance }}</span>
          </div>
        </div>
        <p class="risk-description">{{ getRiskDescription() }}</p>
      </mat-card-content>
    </mat-card>

    <!-- Stock Recommendations Table -->
    <mat-card class="recommendations-card mb-3">
      <mat-card-header>
        <mat-card-title>Stock Recommendations</mat-card-title>
        <mat-card-subtitle>{{ portfolioRecommendation.recommendations.length }} stocks selected for your portfolio</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <table mat-table [dataSource]="portfolioRecommendation.recommendations" class="recommendations-table">
          <ng-container matColumnDef="symbol">
            <th mat-header-cell *matHeaderCellDef>Symbol</th>
            <td mat-cell *matCellDef="let stock">
              <strong>{{ stock.symbol }}</strong>
            </td>
          </ng-container>

          <ng-container matColumnDef="companyName">
            <th mat-header-cell *matHeaderCellDef>Company</th>
            <td mat-cell *matCellDef="let stock">{{ stock.companyName }}</td>
          </ng-container>

          <ng-container matColumnDef="sector">
            <th mat-header-cell *matHeaderCellDef>Sector</th>
            <td mat-cell *matCellDef="let stock">
              <span class="sector-chip">{{ stock.sector }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="allocation">
            <th mat-header-cell *matHeaderCellDef>Allocation</th>
            <td mat-cell *matCellDef="let stock">
              <span class="allocation-value">{{ stock.allocation.toFixed(1) }}%</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="expectedReturn">
            <th mat-header-cell *matHeaderCellDef>Expected Return</th>
            <td mat-cell *matCellDef="let stock">
              <span class="return-value">{{ stock.expectedReturn.toFixed(1) }}%</span>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>

    <!-- Charts Section -->
    <div class="charts-section">
      <!-- Asset Allocation Pie Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Asset Allocation</mat-card-title>
          <mat-card-subtitle>Portfolio distribution by stock</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <div class="chart-container">
            <canvas #pieChartCanvas></canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Projected Growth Line Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Projected Growth</mat-card-title>
          <mat-card-subtitle>Expected portfolio value over time</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <div class="chart-container">
            <canvas #lineChartCanvas></canvas>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons mt-3">
      <button mat-button (click)="modifyAssessment()" class="secondary-button">
        Modify Assessment
      </button>
      <button mat-raised-button color="primary" (click)="startNewAssessment()">
        Start New Analysis
      </button>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !portfolioRecommendation" class="error-container">
    <mat-card>
      <mat-card-content class="text-center">
        <mat-icon class="error-icon">error</mat-icon>
        <h3>Unable to Generate Portfolio</h3>
        <p>There was an issue generating your portfolio recommendations. Please try again.</p>
        <button mat-raised-button color="primary" (click)="modifyAssessment()">
          Try Again
        </button>
      </mat-card-content>
    </mat-card>
  </div>
</div>